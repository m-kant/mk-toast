# Bundlers quirks

Как написанную на TypeScript библиотеку собрать в JS вместе с type declaration (d.ts) файлами.

Проблемы бандлеров, рассчитанных на написание приложений (Webpack, Rollup) в том, что они требуют импорта сопутствующих ресурсов непосредственно в скрипт. Это анонимный импорт типа `import styles.css;`. Такой импорт засоряет `d.ts` файлы, т.к. компилятор не удяляет их из `d.ts` файлов (хотя удаляет из .js).

Таким образом, если к библиотеке нужны .d.ts и в ней имеются дополнительные ресурсы - её нельзя нормально собрать только бандлером.

## Webpack

Требует анонимный импорт ресурсов и засоряет d.ts. Если импортировать ресурс как переменную `import _ignored from './styles.scss'` то
он перестает собираться вебпаком в `CSS`

При экспорте `export default` - в библиотеке создает поле `myLib.default` куда складывает библиотеку в виде объекта.
Чтобы получилось то что нужно, приходится писать `module.exports = myLib`

## Rollup

Требует анонимный импорт ресурсов и засоряет d.ts.

Чтобы сгенерировать и сохранить `d.ts` надо поставить в `.tsconfig` `declarationDir`. А если стоит `declarationDir` то в конфиге роллапа вместо `file` надо ставить `dir` и в этом случае он перестает собирать под разными именами файлов и следовательно под разные модульные системы. Т.е. нормально можно собрать только одну сборку.

В `.tsconfig` надо ставить `modules: "esnext"`

`rollup-plugin-scss` или `rollup-plugin-styles` работают только если в `.tsconfig` поставить `compilerOptions.target = "esnext"`

## Gulp

Вообще проблема сохранить сгенерированный `d.ts` [gulp-typescript](https://www.npmjs.com/package/gulp-typescript) рубит результат на два разных стрима - один с js файлами, другой c d.ts

## TSC (TypeScript Compiler)

Собирает в один файл из нескольких .ts файлов только в формате amd и system модулей

То что tsc называет UMD модулями в броузере открываться не может -
оно радикально отличается от того, что генерирует, например, rollup.
